# ABUILD generated by mkpkg_generator.sh

pkgname=ghostscript
pkgver=9.04
pkgbuild=3
arch=("auto")

shortdesc=("GPL Ghostscript")
longdesc=("An interpreter for the PostScript language")

tags=("app-text console")

# Automatically-generated build_deps. Subject to revision.
build_deps="gcc-libs glibc-solibs lcms libpng libgpg-error fontconfig libgcrypt jasper krb5 e2fsprogs libXt libXext libSM libICE cairo libX11 libidn gnutls dbus atk pango freetype libjpeg glib2 gtk+2 libtiff cups gdk-pixbuf"

source=("http://downloads.ghostscript.com/public/ghostscript-${pkgver}.tar.bz2")


# Fails to build with multiple jobs
numjobs=1

before_build() {
	go_src_dir
	# force it to use system-libs
	rm -rf jpeg libpng zlib jasper expat tiff freetype lcms
}
build() {
	go_src_dir
	burn_patches
	set -e
	./configure --prefix=/usr \
		--libdir=/usr/lib${LIBDIRSUFFIX} \
		--mandir=/usr/man \
		--enable-dynamic \
		--with-ijs \
		--with-jbig2dec \
		--with-omni \
		--with-x \
		--with-drivers=ALL\
		--with-fontpath=/usr/share/fonts/Type1:/usr/share/fonts \
		--without-luratech \
		--with-install-cups \
		--enable-fontconfig \
		--enable-freetype \
		--disable-compile-inits

	make -j${numjobs}

	# Build IJS
	( cd ijs
		./autogen.sh
		./configure --prefix=/usr --libdir=/usr/lib${LIBDIRSUFFIX} --enable-shared --disable-static
		make -j${numjobs}
	)

	make DESTDIR=${pkgdir} cups_serverroot=${pkgdir}/etc/cups cups_serverbin=${pkgdir}/usr/lib${LIBDIRSUFFIX}/cups install soinstall

	# install IJS
	( cd ijs ; make DESTDIR=${pkgdir} install )

	set +e
}

