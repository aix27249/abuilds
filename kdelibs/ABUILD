# ABUILD generated by mkpkg_generator.sh

pkgname=kdelibs
pkgver=4.14.0
pkgbuild=1
arch=('auto')

config_files="etc/xdg/menus/kde-applications.menu"

shortdesc=('kdelibs (KDE libraries)')

longdesc=('System libraries and other resources required by KDE')

tags=('kde-base kde4')

source=("ftp://ftp.kde.org/pub/kde/stable/${pkgver}/src/kdelibs-${pkgver}.tar.xz")

build_deps="cmake automoc4 perl gcc openssl phonon docbook-xsl bzip2 strigi polkit qca shared-mime-info udisks2 upower hspell mesa flex bison libattica enchant giflib grantlee jasper dbusmenu-qt utempter libXcursor media-player-info openexr"

if [ -d /usr/lib${LIBDIRSUFFIX}/qt ]; then
   QTDIR=/usr/lib${LIBDIRSUFFIX}/qt
fi

BUILD_SYSTEM='cmake'

BUILD_KEYS="-DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DMAN_INSTALL_DIR=/usr/man \
    -DSYSCONF_INSTALL_DIR=/etc \
    -DLIB_SUFFIX=${LIBDIRSUFFIX} \
    -DWITH_FAM=OFF \
    -DCMAKE_SKIP_RPATH=ON \
    -DKAUTH_BACKEND=PolkitQt-1 \
    -DKDE_DISTRIBUTION_TEXT=\"AgiliaLinux\""

INSTALL_KEYS="DESTDIR=${pkgdir}"

after_build(){
  # cert bundle seems to be hardcoded
  # link it to the one from ca-certificates
  rm -f "${pkgdir}"/usr/share/apps/kssl/ca-bundle.crt
  ln -sf /etc/ssl/certs/ca-certificates.crt "${pkgdir}"/usr/share/apps/kssl/ca-bundle.crt
}