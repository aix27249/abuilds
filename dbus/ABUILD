# ABUILD generated by mkpkg_generator.sh

pkgname=dbus
pkgver=1.6.12
pkgbuild=2
arch=('auto')

shortdesc=("Freedesktop.org message bus system")
longdesc=('D-Bus supplies both a system daemon (for events such as "new hardware device added" or "printer queue changed") and a per user login session daemon (for general IPC needs among user applications). Also, the message bus is built on top of a general one-to-one message passing framework, which can be used by any two apps to communicate directly (without going through the message bus daemon).')

tags=('base sys-apps')
build_deps="expat coreutils libX11"
source=("http://dbus.freedesktop.org/releases/dbus/dbus-${pkgver}.tar.gz")

config_files="etc/dbus-1/system.conf
etc/dbus-1/session.conf"


BUILD_SYSTEM="autotools"
BUILD_KEYS="--prefix=/usr \
	--libdir=/usr/lib${LIBDIRSUFFIX} \
	--sysconfdir=/etc \
	--localstatedir=/var \
	--mandir=/usr/man \
	--infodir=/usr/info \
	--docdir=/usr/doc/$pkgname-$pkgver \
	--enable-shared=yes \
	--enable-static=no \
	--with-system-pid-file=/var/run/dbus/dbus.pid \
	--with-system-socket=/var/run/dbus/system_bus_socket \
	--with-console-auth-dir=/var/run/console \
	--with-init-scripts=openrc"


after_build() {
	go_src_dir
	set -e

	# Fix some directory ownership
	chown messagebus ${pkgdir}/var/lib/dbus

	# Add OpenRC scripts
	mkdir -p ${pkgdir}/etc/init.d
	install -m755 $filedir/dbus.init ${pkgdir}/etc/init.d/dbus
	
	# Add socket dir. DBus cannot do it and keep silent about
	mkdir -p ${pkgdir}/var/run/dbus

	set +e
}
