# ABUILD generated by mkpkg_generator.sh

pkgname=iproute2
pkgver=3.14.0
pkgbuild=2
arch=("auto")

shortdesc=("IP routing utilities")
longdesc=("These are tools used to administer many advanced IP routing features in the kernel. See Configure.help in the kernel documentation (search for iproute2) for more information on which kernel options these tools are used with. These utilities were written by Alexey Kuznetsov. The current maintainer of iproute2 is Stephen Hemminger.")

tags=("sys-apps network")

source=("http://www.kernel.org/pub/linux/utils/net/${pkgname}/${pkgname}-${pkgver}.tar.xz")

build_deps="make gcc glibc-solibs iptables"

before_build(){
  go_src_dir
  # do not treat warnings as errors
  sed -i 's|-Werror||' Makefile
  sed -i 's|DOCDIR=$(DATADIR)/doc/iproute2|DOCDIR=/usr/doc/'"${pkgname}-${pkgver}"'|' Makefile
}

BUILD_SYSTEM="autotools"

BUILD_KEYS="--prefix=/usr \
            --libdir=/usr/lib$LIBDIRSUFFIX \
            --mandir=/usr/man \
            --sysconfdir=/etc"

INSTALL_KEYS="DESTDIR=${pkgdir}"

after_build() {
  go_src_dir
  # libnetlink isn't installed, install it FS#19385
  install -Dm644 include/libnetlink.h "${pkgdir}/usr/include/libnetlink.h"
  install -Dm644 lib/libnetlink.a "${pkgdir}/usr/lib$LIBDIRSUFFIX/libnetlink.a"
  rm -r "${pkgdir}"/usr/lib
}