# ABUILD generated by mkpkg_generator.sh

pkgname=xz
pkgver=5.0.4
pkgbuild=2
arch=('auto')

shortdesc=('Compression utility based on the LZMA algorithm')
longdesc=('LZMA is a general purporse compression algorithm designed by Igor Pavlov as part of 7-Zip. It provides high compression ratio while keeping the decompression speed fast. XZ Utils are an attempt to make LZMA compression easy to use on free (as in freedom) operating systems. The people most responsible for xz are Igor Pavlov, Ville Koskinen, and Lasse Collin. For more info: http://tukaani.org/xz/')

tags=('base app-arch')

source=(http://tukaani.org/xz/xz-${pkgver}.tar.gz)
build_deps="glibc-solibs"

BUILD_SYSTEM='autotools'
BUILD_KEYS="--prefix=/usr \
	--libdir=/usr/lib${LIBDIRSUFFIX} \
	--docdir=/usr/doc/xz-${pkgver} \
	--sysconfdir=/etc \
	--mandir=/usr/man \
	--enable-shared \
	--disable-static \
	--disable-rpath"
INSTALL_KEYS="DESTDIR=$pkgdir"
after_build() {
	go_src_dir

	# It might be advisable to have the libraries in /lib${LIBDIRSUFFIX}:
	mkdir -p ${pkgdir}/lib${LIBDIRSUFFIX}
	mv ${pkgdir}/usr/lib${LIBDIRSUFFIX}/liblzma.so.* ${pkgdir}/lib${LIBDIRSUFFIX}
	( cd ${pkgdir}/usr/lib${LIBDIRSUFFIX}
		rm -f liblzma.so
		ln -sf ../../lib${LIBDIRSUFFIX}/liblzma.so.? liblzma.so
	)

	# At least the xz binary should also be in /bin:
	mkdir -p ${pkgdir}/bin
	mv ${pkgdir}/usr/bin/xz ${pkgdir}/bin
	( cd ${pkgdir}/usr/bin
		ln -sf ../../bin/xz .
	)

	# Backward compatibility
	ln -s liblzma.so ${pkgdir}/usr/lib${LIBDIRSUFFIX}/liblzma.so.0

}
